#!/bin/bash
#
# Description: init script for the yadtreceiver.
#
# Author:      Arne Hilmann <arne.hilmann@gmail.com>

set -e -E -u

PIDFILE=/var/run/yadtreceiver.pid
TACFILE=/etc/twisted-taps/yadtreceiver.tac
TWISTD=/usr/bin/twistd
CONFIGFILE=/etc/sysconfig/yadtreceiver

[[ -r $CONFIGFILE ]] && source $CONFIGFILE

case "${1:-}" in
    start)
        echo "starting yadtreceiver"
        $TWISTD --pidfile=$PIDFILE --python=$TACFILE ${uid:+--uid=$uid} ${gid:+--gid=$gid}
    ;;
    stop)
        [[ -e $PIDFILE ]] || { echo "no pid file, already stopped?!"; exit 0; }
        PID=$(cat $PIDFILE)
        echo "stopping yadtreceiver with pid $PID"
        kill -QUIT $PID && rm -f $PIDFILE
    ;;
    status)
        [[ -e $PIDFILE ]] || exit 3
        PID=$(cat $PIDFILE)
        ps $PID > /dev/null && exit
    ;;
    *)
        echo "Usage: $0 {start|stop|status}" >&2
        exit 3
    ;;
esac
